<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Temp Todo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script crossorigin src="https://unpkg.com/react@16/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.min.js'></script>
    <link rel='stylesheet' href='.\components\TodoComponents\Todo.css' />
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400" rel="stylesheet">
</head>
<body>
    <div id='app'></div>

    <script type='text/babel'>

        const TodoForm = props => (
            <form>
                <input type='text' 
                value={props.input}
                placeholder='Please Enter a Todo'
                onChange={props.handleChange}
                onKeyDown={(e) => e.keyCode === 13 ? props.addTodo(e) : null}
                />
                <button type='button' onClick={props.addTodo}>Add Todo</button>
                <button type='button' onClick={props.clearComplete}>Clear Completed</button>
            </form>
        );

        const Todo = props => (
            <li onClick={() => props.markComplete(props.item)} className={`complete-${props.item.completed}`}>
                {props.item.task}
            </li>
        );

        const TodoList = props => (
            <ul>
                {props.list.map(item => <Todo markComplete={props.markComplete} item={item}/>)}
            </ul>
        );

        class App extends React.Component{
            constructor(props){
                super(props);
                this.state = {
                    input: '',
                    todo: [
                    {
                        task: 'Organize Garage',
                        id: 1528817077286,
                        completed: false
                    },
                    {
                        task: 'Bake Cookies',
                        id: 1528817084358,
                        completed: false
                    }
                    ],
                };
            }

            markComplete = item => {
                this.setState((prevState) => {
                    const newTodo = prevState.todo;
                    newTodo.forEach(x => {
                        if(x.id === item.id) x.completed = !x.completed;
                    });
                    return {
                        todo: newTodo,
                    }
                });
            }

            handleChange = e => {
                this.setState({
                    input: e.target.value,
                });
            }

            addTodo = (e) => {
                if (e.keyCode === 13) e.preventDefault();
                if (!this.state.input){
                    alert('Please Enter a Todo');
                    return;
                }
                this.setState((prevState) => ({
                    input: '',
                    todo: prevState.todo.concat(
                        {
                            task: prevState.input, 
                            id: Date.now(), 
                            completed: false
                        }),
                    })
                );
            }

            clearComplete = () => {
                this.setState((prevState) => ({
                    todo: prevState.todo.filter(x => !x.completed),
                }));
            }

            render(){
                return (
                    <div>
                        <TodoForm handleChange={this.handleChange}
                            addTodo={this.addTodo}
                            input={this.state.input}
                            clearComplete={this.clearComplete}
                        />
                        <TodoList list={this.state.todo} 
                            markComplete={this.markComplete}
                        />
                        <div className='key'>
                            <div>
                                <div className='complete'></div>
                                <span>= Complete</span>
                            </div>
                            <div>
                                <div className='incomplete'></div>
                                <span>= Incomplete </span>
                            </div>
                        </div>
                    </div>
                );
            }
        }

        ReactDOM.render(
            <App />,
            document.querySelector('#app')
        );
    </script>
</body>
</html>